"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DO_NOT_DEPLOY = exports.DO_NOT_DISPLAY = exports.LOCKED_PREFIX = exports.UNI_PATCH = exports.W3_TEMP_DATA_DIR = exports.CONFIG_MATRIX_REL_PATH = exports.I18N_NAMESPACE = exports.LOAD_ORDER_FILENAME = exports.MERGE_INV_MANIFEST = exports.SCRIPT_MERGER_ID = exports.PART_SUFFIX = exports.INPUT_XML_FILENAME = exports.GAME_ID = exports.getPriorityTypeBranch = exports.getLoadOrderFilePath = exports.UNIAPP = exports.getHash = exports.calcHashImpl = exports.MergeDataViolationError = exports.ResourceInaccessibleError = exports.MD5ComparisonError = void 0;
const crypto_1 = __importDefault(require("crypto"));
const electron_1 = require("electron");
const path_1 = __importDefault(require("path"));
const vortex_api_1 = require("vortex-api");
class MD5ComparisonError extends Error {
    constructor(message, file) {
        super(message);
        this.mPath = file;
    }
    get affectedFile() {
        return this.mPath;
    }
    get errorMessage() {
        return this.message + ': ' + this.mPath;
    }
}
exports.MD5ComparisonError = MD5ComparisonError;
class ResourceInaccessibleError extends Error {
    constructor(filePath, allowReport = false) {
        super(`"${filePath}" is being manipulated by another process`);
        this.mFilePath = filePath;
        this.mIsReportingAllowed = allowReport;
    }
    get isOneDrive() {
        const segments = this.mFilePath.split(path_1.default.sep)
            .filter(seg => !!seg)
            .map(seg => seg.toLowerCase());
        return segments.includes('onedrive');
    }
    get allowReport() {
        return this.mIsReportingAllowed;
    }
    get errorMessage() {
        return (this.isOneDrive)
            ? this.message + ': ' + 'probably by the OneDrive service.'
            : this.message + ': ' + 'close all applications that may be using this file.';
    }
}
exports.ResourceInaccessibleError = ResourceInaccessibleError;
class MergeDataViolationError extends Error {
    constructor(notIncluded, optional, collectionName) {
        super(`Merged script data for ${collectionName} is referencing missing/undeployed/optional mods`);
        this.name = 'MergeDataViolationError';
        this.mOptional = optional;
        this.mNotIncluded = notIncluded;
        this.mCollectionName = collectionName;
    }
    get Optional() {
        return this.mOptional;
    }
    get NotIncluded() {
        return this.mNotIncluded;
    }
    get CollectionName() {
        return this.mCollectionName;
    }
}
exports.MergeDataViolationError = MergeDataViolationError;
function calcHashImpl(filePath) {
    return new Promise((resolve, reject) => {
        const hash = crypto_1.default.createHash('md5');
        const stream = vortex_api_1.fs.createReadStream(filePath);
        stream.on('readable', () => {
            const data = stream.read();
            if (data) {
                hash.update(data);
            }
        });
        stream.on('end', () => resolve(hash.digest('hex')));
        stream.on('error', reject);
    });
}
exports.calcHashImpl = calcHashImpl;
function getHash(filePath, tries = 3) {
    return calcHashImpl(filePath)
        .catch(err => {
        if (['EMFILE', 'EBADF'].includes(err['code']) && (tries > 0)) {
            return getHash(filePath, tries - 1);
        }
        else {
            return Promise.reject(err);
        }
    });
}
exports.getHash = getHash;
exports.UNIAPP = electron_1.app || electron_1.remote.app;
function getLoadOrderFilePath() {
    return path_1.default.join(exports.UNIAPP.getPath('documents'), 'The Witcher 3', exports.LOAD_ORDER_FILENAME);
}
exports.getLoadOrderFilePath = getLoadOrderFilePath;
function getPriorityTypeBranch() {
    return ['settings', 'witcher3', 'prioritytype'];
}
exports.getPriorityTypeBranch = getPriorityTypeBranch;
exports.GAME_ID = 'witcher3';
exports.INPUT_XML_FILENAME = 'input.xml';
exports.PART_SUFFIX = '.part.txt';
exports.SCRIPT_MERGER_ID = 'W3ScriptMerger';
exports.MERGE_INV_MANIFEST = 'MergeInventory.xml';
exports.LOAD_ORDER_FILENAME = 'mods.settings';
exports.I18N_NAMESPACE = 'game-witcher3';
exports.CONFIG_MATRIX_REL_PATH = path_1.default.join('bin', 'config', 'r4game', 'user_config_matrix', 'pc');
exports.W3_TEMP_DATA_DIR = path_1.default.join(vortex_api_1.util.getVortexPath('temp'), 'W3TempData');
exports.UNI_PATCH = 'mod0000____CompilationTrigger';
exports.LOCKED_PREFIX = 'mod0000_';
exports.DO_NOT_DISPLAY = ['communitypatch-base'];
exports.DO_NOT_DEPLOY = ['readme.txt'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29tbW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLG9EQUE0QjtBQUM1Qix1Q0FBdUM7QUFDdkMsZ0RBQXdCO0FBQ3hCLDJDQUFzQztBQUN0QyxNQUFhLGtCQUFtQixTQUFRLEtBQUs7SUFFM0MsWUFBWSxPQUFPLEVBQUUsSUFBSTtRQUN2QixLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDZixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztJQUNwQixDQUFDO0lBRUQsSUFBSSxZQUFZO1FBQ2QsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3BCLENBQUM7SUFFRCxJQUFJLFlBQVk7UUFDZCxPQUFPLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDMUMsQ0FBQztDQUNGO0FBZEQsZ0RBY0M7QUFFRCxNQUFhLHlCQUEwQixTQUFRLEtBQUs7SUFHbEQsWUFBWSxRQUFRLEVBQUUsV0FBVyxHQUFHLEtBQUs7UUFDdkMsS0FBSyxDQUFDLElBQUksUUFBUSwyQ0FBMkMsQ0FBQyxDQUFDO1FBQy9ELElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO1FBQzFCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxXQUFXLENBQUM7SUFDekMsQ0FBQztJQUVELElBQUksVUFBVTtRQUNaLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLGNBQUksQ0FBQyxHQUFHLENBQUM7YUFDNUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQzthQUNwQixHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztRQUNqQyxPQUFPLFFBQVEsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVELElBQUksV0FBVztRQUNiLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDO0lBQ2xDLENBQUM7SUFFRCxJQUFJLFlBQVk7UUFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUN0QixDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLEdBQUcsbUNBQW1DO1lBQzNELENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksR0FBRyxxREFBcUQsQ0FBQztJQUNoRixDQUFDO0NBQ0o7QUF6QkQsOERBeUJDO0FBRUQsTUFBYSx1QkFBd0IsU0FBUSxLQUFLO0lBWWhELFlBQVksV0FBcUIsRUFBRSxRQUFrQixFQUFFLGNBQXNCO1FBQzNFLEtBQUssQ0FBQywwQkFBMEIsY0FBYyxrREFBa0QsQ0FBQyxDQUFDO1FBQ2xHLElBQUksQ0FBQyxJQUFJLEdBQUcseUJBQXlCLENBQUM7UUFDdEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7UUFDMUIsSUFBSSxDQUFDLFlBQVksR0FBRyxXQUFXLENBQUM7UUFDaEMsSUFBSSxDQUFDLGVBQWUsR0FBRyxjQUFjLENBQUM7SUFDeEMsQ0FBQztJQUVELElBQVcsUUFBUTtRQUNqQixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQVcsV0FBVztRQUNwQixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDM0IsQ0FBQztJQUVELElBQVcsY0FBYztRQUN2QixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUE7SUFDN0IsQ0FBQztDQUNGO0FBL0JELDBEQStCQztBQUVELFNBQWdCLFlBQVksQ0FBQyxRQUFRO0lBQ25DLE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFDckMsTUFBTSxJQUFJLEdBQUcsZ0JBQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEMsTUFBTSxNQUFNLEdBQUcsZUFBRSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzdDLE1BQU0sQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtZQUN6QixNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDM0IsSUFBSSxJQUFJLEVBQUU7Z0JBQ1IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUNuQjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BELE1BQU0sQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzdCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQWJELG9DQWFDO0FBRUQsU0FBZ0IsT0FBTyxDQUFDLFFBQVEsRUFBRSxLQUFLLEdBQUcsQ0FBQztJQUN6QyxPQUFPLFlBQVksQ0FBQyxRQUFRLENBQUM7U0FDMUIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ1gsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDNUQsT0FBTyxPQUFPLENBQUMsUUFBUSxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztTQUNyQzthQUFNO1lBQ0wsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQzVCO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBVEQsMEJBU0M7QUFFWSxRQUFBLE1BQU0sR0FBRyxjQUFHLElBQUksaUJBQU0sQ0FBQyxHQUFHLENBQUM7QUFDeEMsU0FBZ0Isb0JBQW9CO0lBQ2xDLE9BQU8sY0FBSSxDQUFDLElBQUksQ0FBQyxjQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxFQUFFLGVBQWUsRUFBRSwyQkFBbUIsQ0FBQyxDQUFDO0FBQ3RGLENBQUM7QUFGRCxvREFFQztBQUVELFNBQWdCLHFCQUFxQjtJQUNuQyxPQUFPLENBQUMsVUFBVSxFQUFFLFVBQVUsRUFBRSxjQUFjLENBQUMsQ0FBQztBQUNsRCxDQUFDO0FBRkQsc0RBRUM7QUFFWSxRQUFBLE9BQU8sR0FBRyxVQUFVLENBQUM7QUFHckIsUUFBQSxrQkFBa0IsR0FBRyxXQUFXLENBQUM7QUFLakMsUUFBQSxXQUFXLEdBQUcsV0FBVyxDQUFDO0FBRTFCLFFBQUEsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUM7QUFDcEMsUUFBQSxrQkFBa0IsR0FBRyxvQkFBb0IsQ0FBQztBQUMxQyxRQUFBLG1CQUFtQixHQUFHLGVBQWUsQ0FBQztBQUN0QyxRQUFBLGNBQWMsR0FBRyxlQUFlLENBQUM7QUFDakMsUUFBQSxzQkFBc0IsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLG9CQUFvQixFQUFFLElBQUksQ0FBQyxDQUFDO0FBRTFGLFFBQUEsZ0JBQWdCLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxpQkFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxZQUFZLENBQUMsQ0FBQztBQUV2RSxRQUFBLFNBQVMsR0FBRywrQkFBK0IsQ0FBQztBQUM1QyxRQUFBLGFBQWEsR0FBRyxVQUFVLENBQUM7QUFFM0IsUUFBQSxjQUFjLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ3pDLFFBQUEsYUFBYSxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XHJcbmltcG9ydCB7IGFwcCwgcmVtb3RlIH0gZnJvbSAnZWxlY3Ryb24nO1xyXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcclxuaW1wb3J0IHsgZnMsIHV0aWwgfSBmcm9tICd2b3J0ZXgtYXBpJztcclxuZXhwb3J0IGNsYXNzIE1ENUNvbXBhcmlzb25FcnJvciBleHRlbmRzIEVycm9yIHtcclxuICBwcml2YXRlIG1QYXRoO1xyXG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIGZpbGUpIHtcclxuICAgIHN1cGVyKG1lc3NhZ2UpO1xyXG4gICAgdGhpcy5tUGF0aCA9IGZpbGU7XHJcbiAgfVxyXG5cclxuICBnZXQgYWZmZWN0ZWRGaWxlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubVBhdGg7XHJcbiAgfVxyXG5cclxuICBnZXQgZXJyb3JNZXNzYWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubWVzc2FnZSArICc6ICcgKyB0aGlzLm1QYXRoO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFJlc291cmNlSW5hY2Nlc3NpYmxlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XHJcbiAgcHJpdmF0ZSBtSXNSZXBvcnRpbmdBbGxvd2VkO1xyXG4gIHByaXZhdGUgbUZpbGVQYXRoO1xyXG4gIGNvbnN0cnVjdG9yKGZpbGVQYXRoLCBhbGxvd1JlcG9ydCA9IGZhbHNlKSB7XHJcbiAgICBzdXBlcihgXCIke2ZpbGVQYXRofVwiIGlzIGJlaW5nIG1hbmlwdWxhdGVkIGJ5IGFub3RoZXIgcHJvY2Vzc2ApO1xyXG4gICAgdGhpcy5tRmlsZVBhdGggPSBmaWxlUGF0aDtcclxuICAgIHRoaXMubUlzUmVwb3J0aW5nQWxsb3dlZCA9IGFsbG93UmVwb3J0O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzT25lRHJpdmUoKSB7XHJcbiAgICBjb25zdCBzZWdtZW50cyA9IHRoaXMubUZpbGVQYXRoLnNwbGl0KHBhdGguc2VwKVxyXG4gICAgICAuZmlsdGVyKHNlZyA9PiAhIXNlZylcclxuICAgICAgLm1hcChzZWcgPT4gc2VnLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgcmV0dXJuIHNlZ21lbnRzLmluY2x1ZGVzKCdvbmVkcml2ZScpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGFsbG93UmVwb3J0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMubUlzUmVwb3J0aW5nQWxsb3dlZDtcclxuICB9XHJcblxyXG4gIGdldCBlcnJvck1lc3NhZ2UoKSB7XHJcbiAgICByZXR1cm4gKHRoaXMuaXNPbmVEcml2ZSlcclxuICAgICAgPyB0aGlzLm1lc3NhZ2UgKyAnOiAnICsgJ3Byb2JhYmx5IGJ5IHRoZSBPbmVEcml2ZSBzZXJ2aWNlLidcclxuICAgICAgOiB0aGlzLm1lc3NhZ2UgKyAnOiAnICsgJ2Nsb3NlIGFsbCBhcHBsaWNhdGlvbnMgdGhhdCBtYXkgYmUgdXNpbmcgdGhpcyBmaWxlLic7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNZXJnZURhdGFWaW9sYXRpb25FcnJvciBleHRlbmRzIEVycm9yIHtcclxuICAvLyBNZXJnZSBkYXRhIHZpb2xhdGlvbiBlcnJvcnMgaW50ZW5kcyB0byBjYXRlciBmb3IvYmxvY2sgY3VyYXRvcnNcclxuICAvLyAgZnJvbSB1cGxvYWRpbmcgYSBjb2xsZWN0aW9uIHdpdGggZmF1bHR5IG1lcmdlZCBkYXRhLlxyXG4gIC8vIFdlIGRlZmluZSBmYXVsdHkgbWVyZ2VkIGRhdGEgYXM6XHJcbiAgLy8gIDEuIEEgbWVyZ2VkIHNjcmlwdCBzZWdtZW50IHdoaWNoIHJlbGllcyBvbiBhIGNlcnRhaW4gbW9kIHRvIGJlIGluY2x1ZGVkIGluIHRoZVxyXG4gIC8vICAgICBjb2xsZWN0aW9uLCB5ZXQgaXQgaXMgbm90IGluY2x1ZGVkLlxyXG4gIC8vICAyLiBBIG1lcmdlZCBzY3JpcHQgc2VnbWVudCB3aGljaCByZXF1aXJlcyBhIHNwZWNpZmljIG1vZCB0byBiZSBpbnN0YWxsZWQsXHJcbiAgLy8gICAgIHlldCB0aGUgY29sbGVjdGlvbiBoaWdobGlnaHRlZCBzYWlkIG1vZCBhcyBcIm9wdGlvbmFsXCI7IHBvdGVudGlhbGx5XHJcbiAgLy8gICAgIHJlc3VsdGluZyBpbiB0aGUgbW9kIGJlaW5nIG1pc3Npbmcgb24gdGhlIHVzZXIgZW5kLlxyXG4gIHByaXZhdGUgbU5vdEluY2x1ZGVkOiBzdHJpbmdbXTtcclxuICBwcml2YXRlIG1PcHRpb25hbDogc3RyaW5nW107XHJcbiAgcHJpdmF0ZSBtQ29sbGVjdGlvbk5hbWU6IHN0cmluZztcclxuICBjb25zdHJ1Y3Rvcihub3RJbmNsdWRlZDogc3RyaW5nW10sIG9wdGlvbmFsOiBzdHJpbmdbXSwgY29sbGVjdGlvbk5hbWU6IHN0cmluZykge1xyXG4gICAgc3VwZXIoYE1lcmdlZCBzY3JpcHQgZGF0YSBmb3IgJHtjb2xsZWN0aW9uTmFtZX0gaXMgcmVmZXJlbmNpbmcgbWlzc2luZy91bmRlcGxveWVkL29wdGlvbmFsIG1vZHNgKTtcclxuICAgIHRoaXMubmFtZSA9ICdNZXJnZURhdGFWaW9sYXRpb25FcnJvcic7XHJcbiAgICB0aGlzLm1PcHRpb25hbCA9IG9wdGlvbmFsO1xyXG4gICAgdGhpcy5tTm90SW5jbHVkZWQgPSBub3RJbmNsdWRlZDtcclxuICAgIHRoaXMubUNvbGxlY3Rpb25OYW1lID0gY29sbGVjdGlvbk5hbWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IE9wdGlvbmFsKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubU9wdGlvbmFsO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBOb3RJbmNsdWRlZCgpIHtcclxuICAgIHJldHVybiB0aGlzLm1Ob3RJbmNsdWRlZDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgQ29sbGVjdGlvbk5hbWUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5tQ29sbGVjdGlvbk5hbWVcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjSGFzaEltcGwoZmlsZVBhdGgpIHtcclxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgY29uc3QgaGFzaCA9IGNyeXB0by5jcmVhdGVIYXNoKCdtZDUnKTtcclxuICAgIGNvbnN0IHN0cmVhbSA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0oZmlsZVBhdGgpO1xyXG4gICAgc3RyZWFtLm9uKCdyZWFkYWJsZScsICgpID0+IHtcclxuICAgICAgY29uc3QgZGF0YSA9IHN0cmVhbS5yZWFkKCk7XHJcbiAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgaGFzaC51cGRhdGUoZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgc3RyZWFtLm9uKCdlbmQnLCAoKSA9PiByZXNvbHZlKGhhc2guZGlnZXN0KCdoZXgnKSkpO1xyXG4gICAgc3RyZWFtLm9uKCdlcnJvcicsIHJlamVjdCk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRIYXNoKGZpbGVQYXRoLCB0cmllcyA9IDMpIHtcclxuICByZXR1cm4gY2FsY0hhc2hJbXBsKGZpbGVQYXRoKVxyXG4gICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgIGlmIChbJ0VNRklMRScsICdFQkFERiddLmluY2x1ZGVzKGVyclsnY29kZSddKSAmJiAodHJpZXMgPiAwKSkge1xyXG4gICAgICAgIHJldHVybiBnZXRIYXNoKGZpbGVQYXRoLCB0cmllcyAtIDEpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IFVOSUFQUCA9IGFwcCB8fCByZW1vdGUuYXBwO1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0TG9hZE9yZGVyRmlsZVBhdGgoKSB7XHJcbiAgcmV0dXJuIHBhdGguam9pbihVTklBUFAuZ2V0UGF0aCgnZG9jdW1lbnRzJyksICdUaGUgV2l0Y2hlciAzJywgTE9BRF9PUkRFUl9GSUxFTkFNRSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRQcmlvcml0eVR5cGVCcmFuY2goKSB7XHJcbiAgcmV0dXJuIFsnc2V0dGluZ3MnLCAnd2l0Y2hlcjMnLCAncHJpb3JpdHl0eXBlJ107XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBHQU1FX0lEID0gJ3dpdGNoZXIzJztcclxuXHJcbi8vIEZpbGUgdXNlZCBieSBzb21lIG1vZHMgdG8gZGVmaW5lIGhvdGtleS9pbnB1dCBtYXBwaW5nXHJcbmV4cG9ydCBjb25zdCBJTlBVVF9YTUxfRklMRU5BTUUgPSAnaW5wdXQueG1sJztcclxuXHJcbi8vIFRoZSBXM01NIG1lbnUgbW9kIHBhdHRlcm4gc2VlbXMgdG8gZW5mb3JjZSBhIG1vZGRpbmcgcGF0dGVyblxyXG4vLyAgd2hlcmUge2ZpbGVuYW1lfS5wYXJ0LnR4dCBob2xkcyBhIGRpZmYgb2Ygd2hhdCBuZWVkcyB0byBiZVxyXG4vLyAgYWRkZWQgdG8gdGhlIG9yaWdpbmFsIGZpbGUgLSB3ZSdyZSBnb2luZyB0byB1c2UgdGhpcyBwYXR0ZXJuIGFzIHdlbGwuXHJcbmV4cG9ydCBjb25zdCBQQVJUX1NVRkZJWCA9ICcucGFydC50eHQnO1xyXG5cclxuZXhwb3J0IGNvbnN0IFNDUklQVF9NRVJHRVJfSUQgPSAnVzNTY3JpcHRNZXJnZXInO1xyXG5leHBvcnQgY29uc3QgTUVSR0VfSU5WX01BTklGRVNUID0gJ01lcmdlSW52ZW50b3J5LnhtbCc7XHJcbmV4cG9ydCBjb25zdCBMT0FEX09SREVSX0ZJTEVOQU1FID0gJ21vZHMuc2V0dGluZ3MnO1xyXG5leHBvcnQgY29uc3QgSTE4Tl9OQU1FU1BBQ0UgPSAnZ2FtZS13aXRjaGVyMyc7XHJcbmV4cG9ydCBjb25zdCBDT05GSUdfTUFUUklYX1JFTF9QQVRIID0gcGF0aC5qb2luKCdiaW4nLCAnY29uZmlnJywgJ3I0Z2FtZScsICd1c2VyX2NvbmZpZ19tYXRyaXgnLCAncGMnKTtcclxuXHJcbmV4cG9ydCBjb25zdCBXM19URU1QX0RBVEFfRElSID0gcGF0aC5qb2luKHV0aWwuZ2V0Vm9ydGV4UGF0aCgndGVtcCcpLCAnVzNUZW1wRGF0YScpO1xyXG5cclxuZXhwb3J0IGNvbnN0IFVOSV9QQVRDSCA9ICdtb2QwMDAwX19fX0NvbXBpbGF0aW9uVHJpZ2dlcic7XHJcbmV4cG9ydCBjb25zdCBMT0NLRURfUFJFRklYID0gJ21vZDAwMDBfJztcclxuXHJcbmV4cG9ydCBjb25zdCBET19OT1RfRElTUExBWSA9IFsnY29tbXVuaXR5cGF0Y2gtYmFzZSddO1xyXG5leHBvcnQgY29uc3QgRE9fTk9UX0RFUExPWSA9IFsncmVhZG1lLnR4dCddOyJdfQ==